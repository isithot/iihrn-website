```{ojs}
//| label: load-data
//| echo: false

statsPlace = FA(bucket_base + "stats/stats_" + stationId + ".json").json()
```

::::::{.column-screen style="height: 95svh;"}
:::::{.column-body style="display: flex; flex-flow: column nowrap; justify-content: space-around; text-align: center; font-weight: bold; font-size: 250%;"}

Is it hot in ${statsPlace.isit_label} right now?

```{ojs}
//| label: answer

answers = ({
  "Hell no!":   {color: "white",   fill1: "#5287d1", fill2: "#2166ac" },
  "No!":        {color: "white",   fill1: "#a2cdeb", fill2: "#67a9cf" },
  "Nope":       {color: "#333333", fill1: "#f5f8fa", fill2: "#d1e5f0" },
  "Not really": {color: "#333333", fill1: "#f7f7f7", fill2: "#ebebeb" },
  "Yup":        {color: "#333333", fill1: "#fddcca", fill2: "#f7cfb7" },
  "Yeah!":      {color: "white",   fill1: "#de7b49", fill2: "#fc946a" },
  "Hell yeah!": {color: "white",   fill1: "#d1231d", fill2: "#b2182b" }
})


html`<span class="iihrn-answer" style="background: linear-gradient(to bottom, ${answers[statsPlace.isit_answer].fill1}, ${answers[statsPlace.isit_answer].fill2}); color: ${answers[statsPlace.isit_answer].color};">${statsPlace.isit_answer}</span>`
```

${statsPlace.isit_comment}


```{=html}
<a id="btn-digdeeper" href="#detail">
  <i class="bi bi-arrow-down-circle-fill" style="background: linear-gradient(to bottom, #333, #555;"></i>
</a>
```

:::::
::::::

::::::{.iihrn-section style="background: #eee"}

:::::{.column-body}

# Here's how today compares... {#detail}

::::{.grid}

:::{.g-col-12 .g-col-md-4}

```{ojs}
//| label: datetime-formatting
datefns = import("https://cdn.skypack.dev/date-fns@3.3.1?min")
tmaxWhen = new Date(Date.parse(statsPlace.isit_maximum_dt || null))
tminWhen = new Date(Date.parse(statsPlace.isit_minimum_dt || null))

tmaxWhenFriendly = isFinite(tmaxWhen) ?
  "(" + datefns.formatRelative(tmaxWhen, new Date()) + ")" : ""
tminWhenFriendly = isFinite(tminWhen) ?
  "(" + datefns.formatRelative(tminWhen, new Date()) + ")" : ""

percentRating = statsPlace.isit_average.toFixed(1) + "%"
```

Today's maximum temperature so far is <strong> ${statsPlace.isit_maximum} °C</strong> ${tmaxWhenFriendly}, and the minimum overnight was <strong> ${statsPlace.isit_minimum} °C</strong> ${tminWhenFriendly}. The average of the two is <strong> ${statsPlace.isit_current} °C</strong>, which is hotter than <strong> ${percentRating} </strong> of daily average temperatures at <strong> ${statsPlace.isit_label}</strong> for this time of year over the period 1939–2021. The bloody hot and cold days (top and bottom 5%, respectively) are outside the dotted lines. 

:::

:::{.g-col-12 .g-col-md-8}
```{ojs}
//| label: ts
//| classes: iihrn-figure
//| echo: false
md`![](${bucket_base + "plots/timeseries/timeseries-" + stationId + ".png"})`
```

:::

::::

::::{.grid style="margin-top: 2rem;"}

:::{.g-col-12 .g-col-md-4}

This is the distribution of temperatures typical for this time of year, which we've defined as a seven day window either side of today. Just like a bell curve, the plot is higher at more common temperatures and lower at rare temperatures.

:::

:::{.g-col-12 .g-col-md-8}
```{ojs}
//| label: dist
//| classes: iihrn-figure
//| echo: false
md`![](${bucket_base + "plots/distribution/distribution-" + stationId + ".png"})`
```
:::

::::

:::::

::::::


:::::{.iihrn-section style="background: #ddd;"}

::::{.column-body .container}

# ... and the rest of the year.

We've compared every day this year at <strong> ${statsPlace.isit_label}</strong> to similar times of year in the past. Red days were hot compared to records; blue days were cold. 

```{ojs}
//| label: hw
//| classes: iihrn-figure
//| echo: false
md`![](${bucket_base + "plots/heatmap/heatmap-" + stationId + ".png"})`
```

::::

:::::
